<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Doces Família Oliveira - Loja</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 20px;
      background: #fff8f0;
      color: #3d2b1f;
    }
    header img.logo {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .products {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    .product {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 10px;
      width: 220px;
      cursor: pointer;
      transition: box-shadow 0.3s ease;
    }
    .product:hover {
      box-shadow: 0 0 15px #8B4513;
    }
    .product h3 {
      margin: 0 0 10px;
      font-size: 1.2em;
    }
    .product p {
      font-size: 0.9em;
      height: 60px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .product .price {
      font-weight: bold;
      color: #8B4513;
      font-size: 1.1em;
    }
    .cart {
      background: #fff3e0;
      padding: 15px;
      border-radius: 10px;
      max-width: 600px;
      margin-bottom: 20px;
      display: none;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .cart-item span {
      flex-grow: 1;
    }
    .cart-item button {
      background: #8B4513;
      border: none;
      color: white;
      padding: 4px 8px;
      margin-left: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    .cart-item button.remove {
      background: #a33;
    }
    form {
      max-width: 600px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      display: none;
    }
    form input, form textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border-radius: 5px;
      border: 1px solid #d1bfa1;
      font-size: 1em;
    }
    form button {
      background: #8B4513;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1.1em;
      border-radius: 6px;
      cursor: pointer;
    }
    #paymentLink {
      max-width: 600px;
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  <img src="logo.png.jpeg" alt="Doces Família Oliveira" class="logo" />
</header>

<h1>Doces Família Oliveira</h1>

<div class="products" id="products"></div>

<div class="cart" id="cart">
  <h2>Seu Carrinho</h2>
  <div id="cartItems"></div>
  <div><strong>Total: R$ <span id="cartTotal">0.00</span></strong></div>
</div>

<form id="customerForm">
  <h2>Dados para entrega</h2>
  <input type="text" id="nome" placeholder="Nome completo" required />
  <textarea id="endereco" placeholder="Endereço de entrega" required rows="2"></textarea>
  <button type="submit">Finalizar Pedido e Gerar Link de Pagamento</button>
</form>

<div id="paymentLink"></div>

<script>
const backendURL = 'https://oliveiradoces.infinityfreeapp.com/checkout.php'; // backend PHP

const produtos = [
  { nome: "Doce de Leite com Paçoca", preco: 10.90, descricao: "Sabor cremoso do doce de leite com toque crocante da paçoca." },
  { nome: "Mousse de Maracujá Cremoso", preco: 12.00, descricao: "Sobremesa leve, refrescante e saborosa." },
  { nome: "Bolo de Brigadeiro", preco: 12.00, descricao: "Camadas fofinhas de bolo com brigadeiro artesanal." },
  { nome: "Bolo de Brigadeiro com Mousse de Maracujá", preco: 12.00, descricao: "Combinação surpreendente de brigadeiro com mousse de maracujá." }
];

let carrinho = [];

const productsDiv = document.getElementById('products');
const cartDiv = document.getElementById('cart');
const cartItemsDiv = document.getElementById('cartItems');
const cartTotalSpan = document.getElementById('cartTotal');
const customerForm = document.getElementById('customerForm');
const paymentLinkDiv = document.getElementById('paymentLink');

function atualizarCarrinho() {
  if (carrinho.length === 0) {
    cartDiv.style.display = 'none';
    customerForm.style.display = 'none';
    paymentLinkDiv.innerHTML = '';
    return;
  }
  cartDiv.style.display = 'block';
  customerForm.style.display = 'block';

  cartItemsDiv.innerHTML = '';
  let total = 0;

  carrinho.forEach((item, idx) => {
    const itemTotal = item.preco * item.quantidade;
    total += itemTotal;

    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <span>${item.quantidade}x ${item.nome} - R$ ${itemTotal.toFixed(2)}</span>
      <button onclick="removerItem(${idx})" class="remove" title="Remover item">X</button>
      <button onclick="alterarQuantidade(${idx}, -1)" title="Diminuir quantidade">-</button>
      <button onclick="alterarQuantidade(${idx}, 1)" title="Aumentar quantidade">+</button>
    `;
    cartItemsDiv.appendChild(div);
  });

  cartTotalSpan.textContent = total.toFixed(2);
}

function removerItem(idx) {
  carrinho.splice(idx, 1);
  atualizarCarrinho();
}

function alterarQuantidade(idx, delta) {
  carrinho[idx].quantidade += delta;
  if (carrinho[idx].quantidade <= 0) {
    removerItem(idx);
  } else {
    atualizarCarrinho();
  }
}

function adicionarProduto(idx) {
  const produto = produtos[idx];
  const existente = carrinho.find(p => p.nome === produto.nome);
  if (existente) {
    existente.quantidade++;
  } else {
    carrinho.push({ nome: produto.nome, preco: produto.preco, quantidade: 1 });
  }
  atualizarCarrinho();
}

produtos.forEach((produto, idx) => {
  const div = document.createElement('div');
  div.className = 'product';
  div.title = produto.descricao;
  div.innerHTML = `
    <h3>${produto.nome}</h3>
    <p>${produto.descricao}</p>
    <div class="price">R$ ${produto.preco.toFixed(2)}</div>
  `;
  div.onclick = () => adicionarProduto(idx);
  productsDiv.appendChild(div);
});

customerForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  if (carrinho.length === 0) {
    alert('Seu carrinho está vazio!');
    return;
  }

  const nome = document.getElementById('nome').value.trim();
  const endereco = document.getElementById('endereco').value.trim();

  if (!nome || !endereco) {
    alert('Por favor, preencha todos os dados para entrega.');
    return;
  }

  let total = 0;
  carrinho.forEach(item => total += item.preco * item.quantidade);

  const data = {
    carrinho,
    cliente: { nome, endereco },
    total
  };

  try {
    const res = await fetch(backendURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const json = await res.json();

    if (json.link) {
      paymentLinkDiv.innerHTML = `
        <p>Pagamento gerado com sucesso!</p>
        <p><a href="${json.link}" target="_blank">Clique aqui para pagar</a></p>
      `;
      carrinho = [];
      atualizarCarrinho();
      customerForm.reset();
      customerForm.style.display = 'none';
    } else {
      paymentLinkDiv.textContent = 'Erro ao gerar link: ' + (json.error || JSON.stringify(json));
    }
  } catch (err) {
    paymentLinkDiv.textContent = 'Erro na comunicação com o servidor: ' + err.message;
  }
});

</script>

</body>
</html>
